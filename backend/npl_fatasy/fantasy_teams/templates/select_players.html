<h2>Select Fantasy Team</h2>

{% if error %}
<p style="color:red"><b>{{ error }}</b></p>
{% endif %}

<form method="post">
{% csrf_token %}

<table border="1" cellpadding="6">
    <tr>
        <th>Select</th>
        <th>Captain</th>
        <th>Vice-Captain</th>
        <th>Player</th>
        <th>Team</th>
        <th>Role</th>
        <th>Cost</th>
    </tr>

    {% for p in players %}
    <tr>
        <td><input type="checkbox" name="players" value="{{ p.player_id }}"></td>
        <td><input type="radio" name="captain" value="{{ p.player_id }}"></td>
        <td><input type="radio" name="vice_captain" value="{{ p.player_id }}"></td>
        <td>{{ p.player_name }}</td>
        <td>{{ p.team_name }}</td>
        <td>{{ p.role }}</td>
        <td>{{ p.cost }}</td>
    </tr>
    {% endfor %}
</table>

<br>
<button type="submit">Save Fantasy Team</button>
</form>
<p id="summary">Selected: 0 | Cost: 0</p>

<script>
const checkboxes = document.querySelectorAll('input[name="players"]');
const summary = document.getElementById('summary');

const costs = {
{% for p in players %}
    "{{ p.player_id }}": {{ p.cost }},
{% endfor %}
};

checkboxes.forEach(cb => {
    cb.addEventListener('change', () => {
        let total = 0;
        let count = 0;

        checkboxes.forEach(c => {
            if (c.checked) {
                count++;
                total += costs[c.value];
            }
        });

        summary.innerText = `Selected: ${count} | Cost: ${total}`;
    });
});
</script>

<p>
<b>Rules:</b><br>
• Exactly 7 players<br>
• Max 4 from one team<br>
• Max 3 per role<br>
• Budget ≤ 60<br>
• Choose 1 Captain & 1 Vice-Captain
</p>
